<!DOCTYPE html>  
<html lang="en">  
<head>  
    <meta charset="UTF-8">  
    <title>用户列表</title>  
    <link rel="stylesheet" href="../css/bootstrap.css">  

    <script src="../js/li/jquery.min.js"></script>  
    <script src="../js/bootstrap.js"></script>
</head>  
<body>
<div class="container" style="margin-top: 80px;">
    <div class="row">
      <div class="span6">
          <div class="span2" style="float: left;">
              <label class="checkbox">姓名</label>
              <input type="text" class="input-small" placeholder="姓名" id="userName">
          </div>
          <div class="span2" style="margin-left: 50px; float: left;">  
              <label class="checkbox" style="width: 150px;">部门</label>
              <select id="selectDepartment" style="width: 150px;height: 25px;">
                  <option>7</option>
                  <option>8</option>
                  <option>9</option>
                  <option>10</option>
                  <option>11</option>
                  <option>12</option>
                  <option>13</option>
                  <option>14</option>
                  <option>15</option>
                  <option>16</option>
                  <option>17</option>
                  <option>18</option>
                  <option>35</option>
                  <option>36</option>
                  <option>37</option>
              </select>
          </div>
          <div class="span2" style="margin-left: 50px; float: left;padding-top: 10px;" >
            <label class="" style="width: 150px;">签到情况</label>
            <div>
              已签到:&nbsp;<input type="radio" name="issign" value="1" title="已签到" style="width: 20px;height: 20px;">&nbsp;&nbsp;&nbsp;
              未签到:&nbsp;<input type="radio" name="issign" value="0" title="未签到" style="width: 20px;height: 20px;">
            </div>
          </div>
          <div class="span2" style="margin-left: 700px;" >
            <div style="height:30px;">
            </div>
            <button type="submit" class="btn" onclick="searchFun();">查询</button>
          </div>
      </div>
      <div class="span6" style="margin-top: 30px;">
          <table class="table table-bordered table-striped table-hover">  
            <tr>  
                <td>序号</td>  
                <td>姓名</td>  
                <td>ID</td> 
                <td>部门</td>
                <td>桌号</td>
                <td>桌号</td>
                <td>签到情况</td>
                <td>操作</td>
            </tr>  
            <%for(var i = 0;i<items.length;i++){%>  
                <tr id='<%=items[i].num%>'>  
                    <td><%=items[i].num%></td>  
                    <td><%=items[i].name%></td>  
                    <td><%=items[i].userid%></td>
                    <td><%=items[i].department%></td>
                    <td class="tablenumber"><%=items[i].table%></td>
                    <td><img src="<%=items[i].avatar%>" style="width:40px;height:40px"/></td>
                    <td id="<%=items[i].userid%>"><%=items[i].issign%></td>
                    <td>
                        <button value="<%=items[i].userid%>" style="margin-left: 200px;" onclick="resetSignup( '<%=items[i].userid%>');">签到重置</button>
                        <button value="<%=items[i].userid%>" style="margin-left: 200px;" 
                        onclick="popUpWindow('<%=items[i].userid%>','<%=items[i].department%>','<%=items[i].num%>');">修改信息</button>
                    </td> 
                </tr>
            <%}%>  
          </table> 
      </div>
    </div>
</div>
<div id="setTable" class="modal fade" style="display: none; width: 100% ;height: 100%;">
    <div class="box box-default extensionDiv" style="margin-left: 42%;margin-top: 100px;width: 300px;height: 200px;background-color: #fff;text-align: center;">
        <div class="box-body">
            <div class="modal-header">
                <a class="close" data-dismiss="modal">×</a>
            </div>
            <div class="modal-body">
              <div>
                <span>请选择部门:</span>
                <select id="setInfoDepartment" style="width: 150px;height: 25px;">
                    <option value="">修改整个部门</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="35">35</option>
                    <option value="36">36</option>
                    <option value="37">37</option>
                </select>
              </div>
              <div style="margin-top: 20px;">
                修改桌号:&nbsp;&nbsp;<input id="tableNumber" type="text" name="" value="" placeholder="请输入桌号">
                
              </div>
            </div>
            <div class="modal-footer" style="height: 50px;">
                <a href="#" class="btn" onclick="changeInfo();">确定</a>
                <a href="#" class="btn" data-dismiss="modal">关闭</a>
            </div>
        </div>
    </div>
</div>
</body> 
<script type="text/javascript" src></script>
<script type="text/javascript">
var user_id;
var user_department;
var user_num;
  function searchFun(){
      var name = $("#userName").val();
      var department = $("#selectDepartment option:selected").val();
      var issign = $("input[type=radio] option:selected").val();
      if(name == '' || name == null || name == undefined){
          name='';
      }
      if(department == '' || department == null || department == undefined){
          department='';
      }
      if(issign == '' || issign == null || issign == undefined){
          issign='';
      }
      if(name =='' && department == '' && issign == '')
        return;
      var data = {"name":name,"department":department, "issign":issign}
       $.ajax({
          url:'http://localhost:9999/api/user/selectUsers',
          type:'post',
          async:false,
          data:data,
          dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
          success:function(data){
            // this.set("items",data)
          },
          error:function(){
            console.log("没有从数据库中搜索到数据!");
          }
      })
  }
  function resetSignup(uid){ 
     $.ajax({
        url:'http://localhost:9999/api/user/resetuser?UserId='+uid+"&issign=0&table=0",
        type:'get',
        async:false,
        dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
        success:function(data){
           $("#"+uid).html(data);
        },
        error:function(){
          console.log("没有从数据库中搜索到数据!");
        }
    })
      console.log(uid);
  }
  function popUpWindow(uid,department,num){
    user_id = '';
    user_department = '';
    user_num = '';
    $("#setTable").modal("show");
    user_id = uid;
    user_department = department;
    user_num = num;

  }
  function changeInfo(){
    var department = $("#setInfoDepartment option:selected").val();
    var table = $("#tableNumber").val();
    $("#tableNumber").val('');
    if(isNaN(table)){
        alert("请输入正确的桌号");
        return ;
    }
    if(department == '' || department == null || department == undefined){
        department = ''
    }
    $.ajax({
        url:'http://localhost:9999/api/user/resetuserinfo',
        type:'post',
        async:false,
        data:{"UserId":user_id,"table":table,"department":department},
        dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
        success:function(data){
          alert("修改成功!");
          $("#setTable").modal("hide");
          location.reload(true);
        },
        error:function(){
          alert("修改桌号失败, 请重新修改!");
        }
    })
    
  }
  
</script> 
</html>  